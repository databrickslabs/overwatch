<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.125.5">
    <meta name="description" content="Overwatch Documentation">
<meta name="author" content="Daniel Tomes -- DatabricksLabs">

    <link rel="icon" href="https://databrickslabs.github.io/overwatch/images/favicon.png" type="image/png">

    <title>Pipeline Validation :: Overwatch</title>

    
    <link href="https://databrickslabs.github.io/overwatch/css/nucleus.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/fontawesome-all.min.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hybrid.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/featherlight.min.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/perfect-scrollbar.min.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/auto-complete.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/atom-one-dark-reasonable.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/theme.css?1727378842" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hugo-theme.css?1727378842" rel="stylesheet">
    
    <link href="https://databrickslabs.github.io/overwatch/css/theme-blue.css?1727378842" rel="stylesheet">
    
    

    <script src="https://databrickslabs.github.io/overwatch/js/jquery-3.3.1.min.js?1727378842"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

<script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="" data-url="https://databrickslabs.github.io/overwatch/deployoverwatch/pipelinevalidation/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://databrickslabs.github.io/overwatch/">
    <img src="https://databrickslabs.github.io/overwatch/images/tmp_logo4.png", width="85%">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/lunr.min.js?1727378842"></script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/auto-complete.js?1727378842"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/databrickslabs.github.io\/overwatch\/";
    
</script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/search.js?1727378842"></script>

    
  </div>
  
  <section id="homelinks">
    <ul>
      <li>
        <a class="padding" href='https://databrickslabs.github.io/overwatch/'><i class='fas fa-home'></i> Home</a>
      </li>
    </ul>
  </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/deployoverwatch/" title="Deploy Overwatch" class="dd-item
        parent
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/">
          Deploy Overwatch
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/cloudinfra/" title="Cloud Infrastructure" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/">
          Cloud Infrastructure
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/cloudinfra/gcp/" title="GCP" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/gcp/">
        GCP
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/cloudinfra/azure/" title="Azure" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/azure/">
        Azure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/cloudinfra/aws/" title="AWS" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/aws/">
        AWS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/configureoverwatch/" title="Configure Overwatch" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/">
          Configure Overwatch
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/configuration/" title="Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/customcosts/" title="Custom Costs" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/customcosts/">
        Custom Costs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/securityconsiderations/" title="Security Considerations" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/securityconsiderations/">
        Security Considerations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/validation/" title="Configuration Validation" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/validation/">
        Configuration Validation
        
        </a>
    </li>
     
  
 

            
          
            
            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/runningoverwatch/" title="Running Overwatch" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/">
          Running Overwatch
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/runningoverwatch/clusterconfig/" title="Cluster Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/clusterconfig/">
        Cluster Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/runningoverwatch/notebook/" title="As A Notebook" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/notebook/">
        As A Notebook
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/runningoverwatch/jar/" title="As A JAR" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/jar/">
        As A JAR
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/pipelinevalidation/" title="Pipeline Validation" class="dd-item active">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/pipelinevalidation/">
        Pipeline Validation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/ucedeployment/" title="Deploying To Unity Catalog" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/">
          Deploying To Unity Catalog
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/" title="UC Storage Requirements" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/">
          UC Storage Requirements
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/aws/" title="AWS" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/aws/">
        AWS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/azure/" title="Azure" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/azure/">
        Azure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/gcp/" title="GCP" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/gcp/">
        GCP
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/uceprereqs/" title="UC Pre-Requisites" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/uceprereqs/">
        UC Pre-Requisites
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/uceconfiguration/" title="UC Configuration Details" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/uceconfiguration/">
        UC Configuration Details
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/migratingtouc/" title="Migrating To UC" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/migratingtouc/">
        Migrating To UC
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/sharingoverwatch/" title="Sharing Overwatch Data" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/sharingoverwatch/">
        Sharing Overwatch Data
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/systemtableintegration/" title="System Table Integration" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/systemtableintegration/">
          System Table Integration
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/systemtableintegration/systemtableconfiguration/" title="System Table Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/systemtableintegration/systemtableconfiguration/">
        System Table Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/systemtableintegration/systemtableprereq/" title="System Table Pre-Requisites" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/systemtableintegration/systemtableprereq/">
        System Table Pre-Requisites
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dataengineer/" title="Data Engineering" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/">
          Data Engineering
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/dataengineer/definitions/" title="Data Dictionary (Latest)" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions/">
          Data Dictionary (Latest)
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            
          
            
            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/modules/" title="Modules / Scopes" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/modules/">
        Modules / Scopes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/pipeline_management/" title="Pipeline_Management" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/pipeline_management/">
        Pipeline_Management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/upgrade/" title="Upgrades" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/upgrade/">
        Upgrades
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/productionizing/" title="Productionizing" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/productionizing/">
        Productionizing
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/advancedtopics/" title="AdvancedTopics" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/advancedtopics/">
        AdvancedTopics
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/changelog/" title="ChangeLog" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/changelog/">
          ChangeLog
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/faq/" title="FAQ" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/faq/">
          FAQ
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dashboards/" title="Dashboards" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dashboards/">
          Dashboards
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/troubleshooting/" title="Troubleshooting" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/troubleshooting/">
          Troubleshooting
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/contributing/" title="" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/contributing/">
          
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <center>

    
    <a class="github-button" href="https://github.com/databrickslabs/overwatch/subscription"
       data-icon="octicon-eye" data-show-count="true" aria-label="Watch Overwatch on GitHub">Watch</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch" data-icon="octicon-star" data-show-count="true" aria-label="Star databrickslabs/overwatch on GitHub">Star</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch/fork"
       data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Overwatch on GitHub">Fork</a>

    <p>A <a href="https://www.databricks.com/learn/labs">Databricks Labs</a> project.</p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://databrickslabs.github.io/overwatch/'>Welcome To OverWatch</a> > <a href='https://databrickslabs.github.io/overwatch/deployoverwatch/'>Deploy Overwatch</a> > Pipeline Validation
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#logical-flow">Logical Flow</a>
      <ul>
        <li><a href="#validation-reports">Validation reports</a></li>
        <li><a href="#rule-types">Rule types</a></li>
        <li><a href="#cross-table-validation">Cross-table validation</a></li>
      </ul>
    </li>
    <li><a href="#pipeline-validation-workflow-integration">Pipeline Validation Workflow Integration</a>
      <ul>
        <li><a href="#default-behavior">Default behavior</a></li>
        <li><a href="#restrict-validation-to-unvalidated-runs">Restrict validation to unvalidated runs</a></li>
        <li><a href="#restrict-validation-to-a-subset-of-tables">Restrict validation to a subset of tables</a></li>
        <li><a href="#disable-cross-table-validation">Disable cross-table validation</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Pipeline Validation
            </h1>
          

        


<h2 id="overview">Overview</h2>
<p>Overwatch provides a special pipeline validation module to perform a
number of data quality, data completeness, and referential integrity
checks on its output.  Pipeline validation may run as frequently as
the regularly scheduled, automated Overwatch ETL pipeline
runs/deployments or manually as a notebook command.  It is used by the
Overwatch maintainers to guard against data quality regressions when
extending and enhancing Overwatch&rsquo;s internal logic.  Similarly, we are
encouraging users to apply this tool to their deployments to provide
data quality readouts and to assist with customer issue resolution.
This page describes its functionality in detail and how to add a
pipeline validation step to an Overwatch workflow.</p>
<h2 id="logical-flow">Logical Flow</h2>
<p>Here is the high-level logical flow of the Pipeline Validation module:</p>
<p><img src="https://databrickslabs.github.io/overwatch/images/DeployOverwatch/Pipeline_Validation.png" alt="PipelineValidationModule"></p>
<ol>
<li>
<p>All workflow tasks of an Overwatch pipeline deployment run to
completion.</p>
</li>
<li>
<p>An additional workflow task executes the Pipeline Validation
module.</p>
</li>
<li>
<p>A health check report for the pipeline is generated with a record
for each check that was performed.</p>
</li>
<li>
<p>Upon failure of any validation check, a snapshot of records that
caused the failure are moved to a quarantine zone for debugging
purpose.</p>
</li>
</ol>

<div class="notices note" ><p>The pipeline validation module is designed to perform its checks on
records that it has not already validated in a previous run to avoid
redundant validation checks. Given that validation has completed
normally following a previous Overwatch pipeline deployment, only new
records produced in one or more subsequent deployments are subject to
validation.</p>
</div>

<h3 id="validation-reports">Validation reports</h3>
<p>Running the validation module produces two types of records:</p>
<ul>
<li>Health check reports</li>
<li>Quarantine reports</li>
</ul>
<h4 id="heath-check-reports">Heath check reports</h4>
<p>Each validation run produces one or more records in the pipeline
health check report for each health check rule according to the number
of Overwatch ETL tables associated with that rule.  Each record
contains a reference to the corresponding Overwatch ETL run and its
snapshot timestamp.</p>
<p>The schema of a health check report is as follows:</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
<th>Description</th>
<th>Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>healthcheck_id</td>
<td>uuid</td>
<td>Unique ID for this Healthcheck_Report record</td>
<td>272b83eb-1362-456a-8dae-26c3083181ac</td>
</tr>
<tr>
<td>etl_database</td>
<td>string</td>
<td>Overwatch ETL database name</td>
<td>ow_etl_azure_0721</td>
</tr>
<tr>
<td>table_name</td>
<td>string</td>
<td>Overwatch ETL table name</td>
<td>clusterstatefact_gold</td>
</tr>
<tr>
<td>healthcheck_rule</td>
<td>string</td>
<td>Description of health check rule applied to the table data</td>
<td>Driver_Node_Type_ID Should Not be NULL</td>
</tr>
<tr>
<td>rule_type</td>
<td>string</td>
<td>Type of validation rule (See enumerated values below.)</td>
<td>Pipeline_Report_Validation</td>
</tr>
<tr>
<td>healthcheckMsg</td>
<td>string</td>
<td>health check status of the table data for this health check rule</td>
<td>health check Failed: got 63 driver_node_type_ids which are null</td>
</tr>
<tr>
<td>overwatch_runID</td>
<td>string</td>
<td>Overwatch run ID of the corresponding snapshot</td>
<td>b8985023d6ae40fa88bb6daef7f46725</td>
</tr>
<tr>
<td>snap_ts</td>
<td>long</td>
<td>Snapshot timestamp in yyyy-mm-dd hh:mm:ss format</td>
<td>2023-09-27 07:43:39</td>
</tr>
<tr>
<td>quarantine_id</td>
<td>uuid</td>
<td>Unique ID for Quarantine Report</td>
<td>cd6d7ecc-b72d-4c16-b8ca-01a6df4fba9c</td>
</tr>
</tbody>
</table>
<h4 id="quarantine-reports">Quarantine reports</h4>
<p>Table rows that do not satisfy the rules configured in the pipeline validation module
appear in the quarantine report using this schema:</p>
<table>
<thead>
<tr>
<th>Column Name</th>
<th>Type</th>
<th>Description</th>
<th>Example Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>quarantine_id</td>
<td>uuid</td>
<td>Unique ID for this Quarantine_Report record</td>
<td>cd6d7ecc-b72d-4c16-b8ca-01a6df4fba9c</td>
</tr>
<tr>
<td>etl_database</td>
<td>string</td>
<td>Overwatch ETL database name</td>
<td>ow_etl_azure_0721</td>
</tr>
<tr>
<td>table_name</td>
<td>string</td>
<td>Overwatch table name</td>
<td>clusterstatefact_gold</td>
</tr>
<tr>
<td>healthcheck_rule_failed</td>
<td>string</td>
<td>Description of health check rule causing the row having keys to be quarantined</td>
<td>Driver_Node_Type_ID Should Not be NULL</td>
</tr>
<tr>
<td>rule_type</td>
<td>string</td>
<td>Type of validation rule (See enumerated values below.)</td>
<td>Pipeline_Report_Validation</td>
</tr>
<tr>
<td>healthcheck_type</td>
<td>string</td>
<td>Denote the failure type of the health check rule.</td>
<td>Warning or Failure</td>
</tr>
<tr>
<td>keys</td>
<td>string</td>
<td>JSON of primary (possibly compound) key value</td>
<td>{&ldquo;cluster_id&rdquo;:&ldquo;0831-200003-6bhv8y0u&rdquo;,&ldquo;state&rdquo;:&ldquo;TERMINATING&rdquo;,&ldquo;unixTimeMS_state_start&rdquo;:1693514245329}</td>
</tr>
<tr>
<td>snap_ts</td>
<td>long</td>
<td>Snapshot timestamp in yyyy-mm-dd hh:mm:ss format</td>
<td>2023-09-27 07:43:39</td>
</tr>
</tbody>
</table>
<p>These reports are persisted to cloud storage as Delta tables.  The
output of the validation module reveals the location of these tables
as shown withing the stack trace in the following screenshot:</p>
<p><img src="https://databrickslabs.github.io/overwatch/images/DeployOverwatch/StackTrace.png" alt="Report StackTrace"></p>
<h3 id="rule-types">Rule types</h3>
<p>The rule_type field mentioned in the Heath Check Report schema above
currently has three possible values:</p>
<ol>
<li><code>'Pipeline_Report_Validation'</code></li>
<li><code>'Single_Table_Validation'</code></li>
<li><code>'Cross_Table_Validation'</code></li>
</ol>
<p>By default the validation module applies health check rules of all
three rule types.  Rules may applied selectively by providing
parameters to the module.  More on this will be discussed in a later
section.</p>
<p>The following sections describe each of these rule types in detail.</p>
<h4 id="pipeline-report-validation">Pipeline report validation</h4>
<p>This rule type validates records in the Overwatch pipeline_report
table.</p>
<p>This rule type has two healthcheck_rule values:</p>
<ul>
<li><code>'Check If Any Module is EMPTY'</code></li>
<li><code>'Check If Any Module is FAILED'</code></li>
</ul>
<h4 id="single-table-validation">Single-table validation</h4>
<p>The healthCheck_rules with this rule_type would be applied to single table. Basically it will check data quality of single tables.
Currently, below tables are in scope of this rule type:</p>
<ul>
<li>clusterstatefact_gold</li>
<li>jobruncostpotentialfact_gold</li>
<li>cluster_gold</li>
<li>sparkjob_gold</li>
<li>sql_query_history_gold</li>
<li>jobrun_gold</li>
<li>job_gold</li>
</ul>
<p>Different health check rules are defined for the following tables:</p>
<h4 id="clusterstatefact_gold">clusterstatefact_gold</h4>
<ul>
<li>cluster_id should not be null</li>
<li>driver_node_type_id should not be null</li>
<li>node_type_id should not be null for multi-node cluster</li>
<li>dbu_rate should be greater than zero for runtime engine is standard or photon</li>
<li>total_cost should be greater than zero for Databricks billable</li>
<li>check whether any single cluster state is running for multiple days</li>
</ul>
<h4 id="jobruncostpotentialfact_gold">jobruncostpotentialfact_gold</h4>
<ul>
<li>job_id should not be null</li>
<li>driver_node_type_id should not be null</li>
<li>job_run_cluster_util_value should not be more than one</li>
<li>check whether any job is running for multiple days</li>
</ul>
<h4 id="cluster_gold">cluster_gold</h4>
<ul>
<li>cluster_id should not be null</li>
<li>driver_node_type_id should not be null</li>
<li>node_type_id should not be null for multi-node cluster</li>
<li>cluster_type should be between serverless, SQL analytics, single-node, standard, high-concurrency</li>
</ul>
<h4 id="sparkjob_gold">sparkjob_gold</h4>
<ul>
<li>cluster_id should not be null</li>
<li>job_id should not be null</li>
<li>db_id_in_job should not be null when db_job_id is not null</li>
</ul>
<h4 id="sql_query_history_gold">sql_query_history_gold</h4>
<ul>
<li>warehouse_id should not be null</li>
<li>query_id should not be null</li>
</ul>
<h4 id="jobrun_gold">jobrun_gold</h4>
<ul>
<li>job_id should not be null</li>
<li>run_id should not be null</li>
<li>job_run_id should not be null</li>
<li>task_run_id should not be null</li>
<li>cluster_id should not be null</li>
</ul>
<h4 id="job_gold">job_gold</h4>
<ul>
<li>job_id should not be null</li>
<li>action should be one of snapimpute, create, reset, update, delete,
resetJobAcl, or changeJobAcl</li>
</ul>
<h3 id="cross-table-validation">Cross-table validation</h3>
<p>The health check rules for this rule type are applied to two or more
tables. This rule type is used to validate data consistency across
tables.</p>
<p>This rule type has the following healthcheck_rule values:</p>
<ul>
<li>job_id present in jobrun_gold but not in jobruncostpotentialfact_gold</li>
<li>job_id present in jobruncostpotentialfact_gold but not in jobrun_gold</li>
<li>cluster_id present in jobrun_gold but not in jobruncostpotentialfact_gold</li>
<li>cluster_id present in jobruncostpotentialfact_gold but not in jobrun_gold</li>
<li>notebook_id present in notebook_gold but not in notebookcommands_gold</li>
<li>notebook_id present in notebookcommands_gold but not in notebook_gold</li>
<li>cluster_id present in clusterstatefact_gold but not in jobruncostpotentialfact_gold</li>
<li>cluster_id present in jobruncostpotentialfact_gold but not in clusterstatefact_gold</li>
<li>cluster_id present in cluster_gold but not in clusterstatefact_gold</li>
<li>cluster_id present in clusterstatefact_gold but not in cluster_gold</li>
</ul>
<h2 id="pipeline-validation-workflow-integration">Pipeline Validation Workflow Integration</h2>
<p>Currently the pipeline validation module runs in a Databricks notebook
cell.  Therefore workflow integration requires adding a notebook task.
Running as JAR task as the regular pipeline deployment does is planned
as a future enhancement.  Its execution starts with default behavior
by calling the <code>PipelineValidation()</code> method with the name of the
target ETL database as its sole mandatory parameter:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">PipelineValidation</span><span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;overwatch_etl&#34;</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p>The module&rsquo;s behavior can be altered by providing one or more of the
following optional parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Optional</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>etlDB</td>
<td>string</td>
<td>No</td>
<td>NA</td>
<td>Overwatch ETL database name to validate</td>
</tr>
<tr>
<td>allRun</td>
<td>boolean</td>
<td>Yes</td>
<td>true</td>
<td>Validate all runs in pipeline_report?</td>
</tr>
<tr>
<td>table</td>
<td>array<!-- raw HTML omitted --></td>
<td>Yes</td>
<td>[]</td>
<td>Subset of default tables to validate.</td>
</tr>
<tr>
<td>crossTableValidation</td>
<td>Boolean</td>
<td>Yes</td>
<td>true</td>
<td>Perform Cross Table Validation?</td>
</tr>
</tbody>
</table>
<p>Below are example pipeline validation runs, first with default behavior
followed by demonstrations of the optional paramaters.</p>
<h3 id="default-behavior">Default behavior</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#66d9ef">val</span> etlDB <span style="color:#66d9ef">=</span> <span style="color:#e6db74">&#34;overwatch_etl&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">PipelineValidation</span><span style="color:#f92672">(</span> etlDB<span style="color:#f92672">)</span>
</span></span></code></pre></div><p><img src="https://databrickslabs.github.io/overwatch/images/DeployOverwatch/Default_Validation_Run.png" alt="Default Run">
Here we can see from the above screenshot that:</p>
<ul>
<li>
<p>Performs validation on all runs present in the <code>pipeline_report</code> table.</p>
</li>
<li>
<p>Performs single-table validation for all pre-defined target tables.</p>
</li>
<li>
<p>Performs cross-table validation for all pre-defined table pairs.</p>
</li>
</ul>
<h3 id="restrict-validation-to-unvalidated-runs">Restrict validation to unvalidated runs</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">PipelineValidation</span><span style="color:#f92672">(</span> etlDB<span style="color:#f92672">,</span> allRun <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p><img src="https://databrickslabs.github.io/overwatch/images/DeployOverwatch/allRun.png" alt="All Run"></p>
<ul>
<li>
<p>Performs validation only on runs in the <code>pipeline_report</code> table not previously validated.</p>
</li>
<li>
<p>Performs single-table validation for all pre-defined target tables.</p>
</li>
<li>
<p>Performs cross-table validation for all pre-defined table pairs.</p>
</li>
</ul>
<h3 id="restrict-validation-to-a-subset-of-tables">Restrict validation to a subset of tables</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">PipelineValidation</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  etlDB<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  table <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Array</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;clusterstatefact_gold&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;jobruncostpotentialfact_gold&#34;</span><span style="color:#f92672">))</span>
</span></span></code></pre></div><p><img src="https://databrickslabs.github.io/overwatch/images/DeployOverwatch/Table_Array.png" alt="Table_Array"></p>
<ul>
<li>
<p>Performs validation on all runs present in the <code>pipeline_report</code> table.</p>
</li>
<li>
<p>Performs single-table validation for the specified subset of target tables.</p>
</li>
<li>
<p>Performs cross-table validation.</p>
</li>
</ul>
<h3 id="disable-cross-table-validation">Disable cross-table validation</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-scala" data-lang="scala"><span style="display:flex;"><span><span style="color:#a6e22e">PipelineValidation</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>  etlDB<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>  table <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Array</span><span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;clusterstatefact_gold&#34;</span><span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;jobruncostpotentialfact_gold&#34;</span><span style="color:#f92672">),</span>
</span></span><span style="display:flex;"><span>  crossTableValidation <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
</span></span></code></pre></div><p><img src="https://databrickslabs.github.io/overwatch/images/DeployOverwatch/cross_validation.png" alt="cross_validation"></p>
<ul>
<li>
<p>Performs validation on all runs present in the <code>pipeline_report</code> table.</p>
</li>
<li>
<p>Performs single-table validation for the specified subset of target tables.</p>
</li>
<li>
<p>Disables cross-table validation.</p>
</li>
</ul>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/jar/" title="As A JAR"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/" title="Deploying To Unity Catalog" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://databrickslabs.github.io/overwatch/js/clipboard.min.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.min.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.jquery.min.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/jquery.sticky.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/featherlight.min.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/highlight.pack.js?1727378842"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://databrickslabs.github.io/overwatch/js/modernizr.custom-3.6.0.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/learn.js?1727378842"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/hugo-learn.js?1727378842"></script>

    <link href="https://databrickslabs.github.io/overwatch/mermaid/mermaid.css?1727378842" rel="stylesheet" />
    <script src="https://databrickslabs.github.io/overwatch/mermaid/mermaid.js?1727378842"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

