<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.115.4">
    <meta name="description" content="Overwatch Documentation">
<meta name="author" content="Daniel Tomes -- DatabricksLabs">

    <link rel="icon" href="https://databrickslabs.github.io/overwatch/images/favicon.png" type="image/png">

    <title>Azure :: Overwatch</title>

    
    <link href="https://databrickslabs.github.io/overwatch/css/nucleus.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/fontawesome-all.min.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hybrid.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/featherlight.min.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/perfect-scrollbar.min.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/auto-complete.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/atom-one-dark-reasonable.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/theme.css?1706289040" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hugo-theme.css?1706289040" rel="stylesheet">
    
    <link href="https://databrickslabs.github.io/overwatch/css/theme-blue.css?1706289040" rel="stylesheet">
    
    

    <script src="https://databrickslabs.github.io/overwatch/js/jquery-3.3.1.min.js?1706289040"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

<script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="" data-url="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/azure/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://databrickslabs.github.io/overwatch/">
    <img src="https://databrickslabs.github.io/overwatch/images/tmp_logo4.png", width="85%">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/lunr.min.js?1706289040"></script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/auto-complete.js?1706289040"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/databrickslabs.github.io\/overwatch\/";
    
</script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/search.js?1706289040"></script>

    
  </div>
  
  <section id="homelinks">
    <ul>
      <li>
        <a class="padding" href='https://databrickslabs.github.io/overwatch/'><i class='fas fa-home'></i> Home</a>
      </li>
    </ul>
  </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/deployoverwatch/" title="Deploy Overwatch" class="dd-item
        parent
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/">
          Deploy Overwatch
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/cloudinfra/" title="Cloud Infrastructure" class="dd-item
        parent
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/">
          Cloud Infrastructure
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/cloudinfra/gcp/" title="GCP" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/gcp/">
        GCP
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/cloudinfra/azure/" title="Azure" class="dd-item active">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/azure/">
        Azure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/cloudinfra/aws/" title="AWS" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/aws/">
        AWS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/configureoverwatch/" title="Configure Overwatch" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/">
          Configure Overwatch
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/configuration/" title="Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/customcosts/" title="Custom Costs" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/customcosts/">
        Custom Costs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/securityconsiderations/" title="Security Considerations" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/securityconsiderations/">
        Security Considerations
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/configureoverwatch/validation/" title="Validation" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/configureoverwatch/validation/">
        Validation
        
        </a>
    </li>
     
  
 

            
          
            
            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/runningoverwatch/" title="Running Overwatch" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/">
          Running Overwatch
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/runningoverwatch/clusterconfig/" title="Cluster Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/clusterconfig/">
        Cluster Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/runningoverwatch/notebook/" title="As A Notebook" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/notebook/">
        As A Notebook
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/runningoverwatch/jar/" title="As A JAR" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/runningoverwatch/jar/">
        As A JAR
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/sharingoverwatch/" title="Sharing Overwatch Data" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/sharingoverwatch/">
        Sharing Overwatch Data
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/ucedeployment/" title="Deploying To Unity Catalog" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/">
          Deploying To Unity Catalog
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/" title="UC Storage Requirements" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/">
          UC Storage Requirements
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/aws/" title="AWS" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/aws/">
        AWS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/azure/" title="Azure" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/azure/">
        Azure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/gcp/" title="GCP" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/cloudstorageaccessrequirements/gcp/">
        GCP
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/uceprereqs/" title="UC Pre-Requisites" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/uceprereqs/">
        UC Pre-Requisites
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/uceconfiguration/" title="UC Configuration Details" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/uceconfiguration/">
        UC Configuration Details
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/ucedeployment/migratingtouc/" title="Migrating To UC" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/ucedeployment/migratingtouc/">
        Migrating To UC
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/deployoverwatch/systemtableintegration/" title="System Table Integration" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/systemtableintegration/">
          System Table Integration
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/systemtableintegration/systemtableconfiguration/" title="System Table Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/systemtableintegration/systemtableconfiguration/">
        System Table Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/deployoverwatch/systemtableintegration/systemtableprereq/" title="System Table Pre-Requisites" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/deployoverwatch/systemtableintegration/systemtableprereq/">
        System Table Pre-Requisites
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dataengineer/" title="Data Engineering" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/">
          Data Engineering
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/dataengineer/definitions/" title="Data Dictionary (Latest)" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions/">
          Data Dictionary (Latest)
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            
          
            
            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/modules/" title="Modules / Scopes" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/modules/">
        Modules / Scopes
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/pipeline_management/" title="Pipeline_Management" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/pipeline_management/">
        Pipeline_Management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/upgrade/" title="Upgrades" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/upgrade/">
        Upgrades
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/productionizing/" title="Productionizing" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/productionizing/">
        Productionizing
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/advancedtopics/" title="AdvancedTopics" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/advancedtopics/">
        AdvancedTopics
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/changelog/" title="ChangeLog" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/changelog/">
          ChangeLog
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/faq/" title="FAQ" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/faq/">
          FAQ
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dashboards/" title="Dashboards" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dashboards/">
          Dashboards
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/troubleshooting/" title="Troubleshooting" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/troubleshooting/">
          Troubleshooting
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/contributing/" title="" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/contributing/">
          
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <center>

    
    <a class="github-button" href="https://github.com/databrickslabs/overwatch/subscription"
       data-icon="octicon-eye" data-show-count="true" aria-label="Watch Overwatch on GitHub">Watch</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch" data-icon="octicon-star" data-show-count="true" aria-label="Star databrickslabs/overwatch on GitHub">Star</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch/fork"
       data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Overwatch on GitHub">Fork</a>

    <p>A <a href="https://www.databricks.com/learn/labs">Databricks Labs</a> project.</p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='https://databrickslabs.github.io/overwatch/'>Welcome To OverWatch</a> > <a href='https://databrickslabs.github.io/overwatch/deployoverwatch/'>Deploy Overwatch</a> > <a href='https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/'>Cloud Infrastructure</a> > Azure
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#fast-travel">Fast Travel</a></li>
    <li><a href="#configuring-overwatch-on-azure-databricks">Configuring Overwatch on Azure Databricks</a></li>
    <li><a href="#reference-architecture">Reference Architecture</a>
      <ul>
        <li><a href="#audit-log-delivery-via-event-hub">Audit Log Delivery via Event Hub</a></li>
        <li><a href="#configuring-event-hub">Configuring Event Hub</a></li>
      </ul>
    </li>
    <li><a href="#setting-up-storage-accounts">Setting up Storage Accounts</a>
      <ul>
        <li><a href="#overview">OVERVIEW</a></li>
        <li><a href="#step-1-1">Step 1</a></li>
        <li><a href="#step-2-1">Step 2</a></li>
        <li><a href="#step-3-1">Step 3</a></li>
        <li><a href="#step-4">Step 4</a></li>
        <li><a href="#step-5">Step 5</a></li>
        <li><a href="#using-the-storage-account">Using the Storage Account</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Azure
            </h1>
          

        


<h2 id="fast-travel">Fast Travel</h2>
<ul>
<li><a href="#configuring-overwatch-on-azure-databricks">Configuring Overwatch on Azure Databricks</a></li>
<li><a href="#reference-architecture">Reference Architecture</a></li>
<li><a href="#reference-architecture-legacy">Reference Architecture (Legacy)</a></li>
<li><a href="#audit-log-delivery-via-event-hub">Configuring Audit Log Delivery Through Event Hub</a></li>
<li><a href="#setting-up-storage-accounts">Setting up Storage Accounts</a></li>
<li><a href="https://docs.databricks.com/data/data-sources/azure/adls-gen2/azure-datalake-gen2-sp-access.html">Mount Storage Accounts</a></li>
</ul>
<h2 id="configuring-overwatch-on-azure-databricks">Configuring Overwatch on Azure Databricks</h2>
<p>Reach out to your Databricks representative to help you with these tasks as needed.
<!-- raw HTML omitted -->
To get started, we suggest you deploy a single workspace end to end so that you can figure out the steps involved and you
can then apply these for the other workspaces to be deployed.</p>
<p>There are two primary sources of data that need to be configured:</p>
<ul>
<li>Audit Logs
<ul>
<li>The audit logs contain data for every interaction within the environment and are used to track the state of various
objects through time along with which accounts interacted with them. This data is relatively small and it certainly
doesn&rsquo;t contain any large data sets like cluster/spark logs.</li>
<li>For ingesting this data, you have the option of using System tables (<strong>RECOMMENDED</strong>) or set up the delivery through Event Hubs</li>
</ul>
</li>
<li>Cluster Logs - Crucial to get the most out of Overwatch
<ul>
<li>Cluster logs delivery location is configured in the cluster spec &ndash;&gt; Advanced Options &ndash;&gt; Logging. These logs can
get quite large and they are stored in a very inefficient format for query and long-term storage.
This is why it&rsquo;s <strong>crucial</strong> to create a dedicated storage account for these and ensure TTL (time-to-live) is enabled
to minimize long-term, unnecessary costs.
It&rsquo;s not recommended to store these on DBFS directly (dbfs mount points are ok).</li>
<li>Best Practice - Multi-Workspace &ndash; When multiple workspaces are using Overwatch within a single region it&rsquo;s best to
ensure that each are going to their own prefix, even if sharing a storage account. This greatly reduces Overwatch scan times
as the log files build up. If scan times get too long, the TTL can be reduced or additional storage accounts can
be created to increase read IOPS throughput (rarely necessary) intra-region.</li>
</ul>
</li>
</ul>
<p><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/Cluster_Logs_Azure.png" alt="AzureClusterLogging"></p>
<h2 id="reference-architecture">Reference Architecture</h2>
<p>As of 0.7.1 Overwatch can be deployed on a single workspace and retrieve data from one or more workspaces. For more details
on requirements see <a href="https://databrickslabs.github.io/overwatch/deployoverwatch//#multi-workspace-monitoring---considerations">Multi-Workspace Consideration</a>.
There are many cases where some workspaces should be able to monitor many workspaces and others should only monitor
themselves. Additionally, co-location of the output data and who should be able to access what data also comes into play,
this reference architecture can accommodate all of these needs. To learn more about the details walk through the
<a href="https://databrickslabs.github.io/overwatch/deployoverwatch/">deployment steps</a>
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/Overwatch_Arch_Azure.png" alt="AzureArch"></p>
<h3 id="audit-log-delivery-via-event-hub">Audit Log Delivery via Event Hub</h3>
<ul>
<li>Audit Log Delivery
<ul>
<li>At present the only supported method for audit log delivery is through Eventhub delivery via Azure Diagnostic Logging.
Overwatch will consume the events as a batch stream (Trigger.Once) once/period when the job runs. To configure
Eventhub to deliver these logs, follow the steps below.</li>
</ul>
</li>
</ul>

<div class="notices note" ><p><strong>LIMIT</strong> If Event Hub subscription is Standard, max of 10 Hubs per Namespace. If more than 10 workspaces are deployed in the same region plan to
distribute your Event Hubs and Namespaces appropriately.</p>
</div>

<h3 id="configuring-event-hub">Configuring Event Hub</h3>
<h4 id="step-1">Step 1</h4>
<p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-create">Create or reuse an Event Hub namespace.</a>

<div class="notices warning" ><p><strong>The Event Hub Namespace MUST be in the same location as your control plane</strong></p>
</div>
</p>

<div class="notices info" ><p>If you select the &ldquo;Basic&rdquo; Pricing Tier, just note that you will be required to ensure at least two successful
Overwatch runs per day to ensure there won&rsquo;t be data loss. This is because message retention is 1 day meaning that
data expires out of EH every 24 hours. &ldquo;Standard&rdquo; Pricing tier doesn&rsquo;t cost much more but
it will give you up to 7 days retention which is much safer if you grow dependent on Overwatch reports.</p>
</div>


<div class="notices info" ><p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-scalability#throughput-units"><strong>Throughput Units</strong></a>
In almost all cases, 1 static throughput unit is sufficient for Overwatch. Cases where this may not be true are
include cases where there are many users across many workspaces sharing a single EH Namespace.
Review the Throughput Units sizing and make the best decision for you.</p>
</div>

<p>Inside the namespace create an Event Hub</p>
<p><strong>ALERT!!</strong></p>
<p><strong>If your Event Hub is behind a VNET</strong>, you must &ldquo;Allow Trusted MSFT Services through the Firewall&rdquo; or configure specific
firewall rules. This should be done in the Event Hub Namespace &ndash;&gt; Networking Tab; see screenshot below.</p>
<p><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/EH_Network.png" alt="EH_Network"></p>
<h4 id="step-2">Step 2</h4>
<p>Create an Event Hub inside your chosen (or created) EH Namespace.

<div class="notices warning" ><p><strong>Every Workspace must have its own Event Hub &ndash; They cannot be shared.</strong> Event Hub namespaces (up to 10 for Standard)
can be shared but the Event Hub must be different. This is to save you time and money since Event Hubs act like topics
and allow us to sub-select data without scanning / streaming it all in just to filter it out. If you try to share an
Event Hub, you will be reloading data as there will be several issues.</p>
</div>
</p>

<div class="notices info" ><p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-scalability#partitions"><strong>Partitions</strong></a>
The maximum number of cores (parallelism) that can simultaneously pull data from your event hub == EH partitions.
In most cases this should be set to 32. It can be fewer, just be sure that Overwatch uses an autoscaling cluster
to minimize costs while waiting to pull the data from EH. For example, if Overwatch is pulling 30 million events
but only has 8 partitions, any worker cores over 8 will sit idle while all 30 million events are retrieved. In a
situation like this, the minimum autoscaling compute size should approximately equal the number of partitions to
minimize waste.</p>
</div>

<p>Overwatch needs access to the Event Hub. There are two methods for provisioning access, either a
<a href="#step-21-authorizing-access-via-sas-policy">SAS Policy with keys in the connection string</a>OR
<a href="#step-22-authorizing-access-via-aad-spn">AAD SPN</a>. Chose your method and follow the docs below.</p>
<h5 id="step-21-authorizing-access-via-sas-policy">Step 2.1 Authorizing Access Via SAS Policy</h5>
<p>Once created, get the connection string from the SAS Policy for the Event Hub, find the following path in the Azure portal below.</p>
<p>eh-namespace &ndash;&gt; eventhub &ndash;&gt; shared access policies &ndash;&gt; Connection String-primary key</p>
<p>The connection string should begin with <code>Endpoint=sb://</code>. Note that the policy only needs the Listen permission</p>
<p>Click Add button and select Listen option for generate policies
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/sas1.png" alt="sas1">
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/sas2.png" alt="sas2">
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/sas3.png" alt="sas3">
Copy the Connection string-primary key and create a secret using Key vault</p>
<h5 id="step-22-authorizing-access-via-aad-spn">Step 2.2 Authorizing Access Via AAD SPN</h5>
<p>Navigate either to the EH Namespace or the Event Hub (whichever is appropriate for you), click on
&ldquo;Access Control (IAM)&rdquo; and then click add &ndash;&gt; Add Role Assignment. Choose the Role
&ldquo;Azure Event Hubs Data Receiver&rdquo; and add the principal you would like to provision &ndash;&gt; review and assign.</p>
<p>Now the Principal has access to the EH or EHNS, now you just need to capture the details of the SPN to provide to
Overwatch configs. These can be found by going to the SPN Overview Active Directory &ndash;&gt; App Registrations &ndash;&gt;
click the principal. Now capture the details in the screenshot below.</p>
<p><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/SPN_Client_tenant_id.png" alt="client_tenant_ids"></p>
<p>Now a secret needs to be created (if one doesn&rsquo;t already exist), so from the previous screen click
&ldquo;Certificates &amp; Secrets&rdquo; &ndash;&gt; &ldquo;New Client Secret&rdquo;. Be sure to capture the secret as it won&rsquo;t be visible later.
Create a Databricks Secret and place the SPN secret in the Databricks secret. This is the value needed to use the
AAD SPN to complete the rest of the AAD required configs.</p>
<p>The last thing you need is your <strong>connection string</strong> and that can be found by navigating back to your Event Hub
** be sure to get to the Event Hub not the Event Hub Namespace (i.e EHNS &ndash;&gt; Event Hubs &ndash;&gt; Event Hub). Then in the
Overview section you will see &ldquo;Namespace&rdquo;, we will use this to construct the connection string.</p>
<p>Endpoint=sb://&lt;namespace&gt;.servicebus.windows.net
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/eh_namespace.png" alt="EH_Namespace"></p>
<h4 id="step-3">Step 3</h4>
<p>With your Event Hub Namespace and Named Event Hub created,
Navigate to your Azure Databricks workspace[s] (in the portal) for which you&rsquo;d like
to enable Overwatch. Under Monitoring section &ndash;&gt; Diagnostics settings &ndash;&gt; Add diagnostic setting. Configure
your log delivery similar to the example in the image below.</p>
<p>Additionally, ensure that the Overwatch account has sufficient privileges to read data from the Event Hub[s] created
above. A common method for providing Overwatch access to the Event Hub is to simply capture the connection string
and store it as a <a href="https://docs.databricks.com/security/secrets/index.html">secret</a>. Proper ways for accessing this
will be in the getting started and configuration sections.
There are many methods through which to authorize Overwatch, just ensure it has the access to read from the Event Hub Stream.</p>

<div class="notices warning" ><p><strong>DO NOT</strong> leave <strong>Event hub name</strong> empty! Even though Azure doesn&rsquo;t require an event hub name, you must create an
event hub underneath the event hub namespace and give it a name. Reference the name here.</p>
</div>

<p><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/EH_BaseConfig.png" alt="EH_Base_Setup"></p>
<h4 id="step-4-validate-messages-are-flowing">Step 4: Validate Messages Are Flowing</h4>
<p>Now that you have configured you Overwatch EventHub Namespace, named Event Hub inside the namespace, and
pointed diagnostic logging to the EventHub it&rsquo;s
time to validate that messages are flowing. You may have to wait several minutes to begin to see messages flowing
depending on how busy the workspace is. There are two things that are commonly missed, please double-check the
two bullet points below, there are images to help clarify as well.</p>
<ul>
<li>A named Event Hub has been created within the Namespace.</li>
<li>Messages are flowing into the named event hub
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/Azure_EH_Example.png" alt="Named_EH_Visual"> <img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/EH_Validation.png" alt="EH_Validation"></li>
</ul>
<h2 id="setting-up-storage-accounts">Setting up Storage Accounts</h2>
<p>The following steps are meant to be a baseline reference for setting up the storage accounts for Overwatch targets.
With regard to security, we cannot make recommendations as to what is best for your organization in a global
forum like this. For specifics regarding security implications of your storage account, please contact your
Databricks sales representative or talk with your Databricks / Cloud administrators.</p>
<p>That said, the minimum technical requirement for Overwatch to function is that the storage account exist and
be able to be access (read/write for Overwatch output, read for cluster logs) the storage from the
Databricks workspace. All security consideration above this basic technical requirement should be commensurate with
your organizational policies/standards.</p>

<div class="notices note" ><p><strong>Data locality</strong> is important for cluster logs. Cluster logs can be large and plentiful and as such, sending these to a
storage account in a different geographical location can have significant performance impact. Keep this in mind and
note that the reference architecture recommends at least one storage account per region to minimize latency and
maximize bandwidth.</p>
</div>

<h3 id="overview">OVERVIEW</h3>
<p>Barring the security and networking sections, once you&rsquo;re setup is complete, your configuration should look similar
the image below.
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_7.png" alt="Storage Overview"></p>
<h3 id="step-1-1">Step 1</h3>
<p>Select Storage Account from your Azure Portal and hit create</p>
<h3 id="step-2-1">Step 2</h3>
<p>Enter your Subscription and Resource Group in Basics Tab
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_1.png" alt="storage1">
Locally-Redundant Storage specified here but choose which is right for your organization. Standard storage is fine,
the required IOPS here are relatively low and, while premium storage will work, it&rsquo;s at an added, unnecessary cost.
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_2.png" alt="storage2"></p>
<h3 id="step-3-1">Step 3</h3>
<p><strong>Recommendations</strong></p>
<ul>
<li>Security &ndash; commensurate with your organization policies but must be accessible from the Databricks Workspace.</li>
<li>Hot access tier
<ul>
<li>Not tested on cold and cold will suffer significant performance loss</li>
</ul>
</li>
<li>Hierarchical namespace
<ul>
<li>While hierarchical namespace is technically option, it&rsquo;s STRONGLY recommended that this be enabled.</li>
</ul>
</li>
<li>Networking, similar to security, this should be configured commensurate with your corporate policies. The only
technical requirement is that the data in the storage account is accessible from the Databricks workspace.
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_3.png" alt="storage3">
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_4.png" alt="storage4"></li>
</ul>
<h3 id="step-4">Step 4</h3>
<p>You may choose any options you prefer here. Note that soft-deletion of BLOBs cannot be mounted to the Databricks
workspace and is considered an experimental feature.
It&rsquo;s recommended that you do NOT enable BlOB soft deletes at this time for the Overwatch
storage account as it has not been fully tested. Container soft deletes are fine.
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_5.png" alt="storage5"></p>
<h3 id="step-5">Step 5</h3>
<p>Add relevant tags and create
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/storage_acc_6.png" alt="storage6"></p>
<h3 id="using-the-storage-account">Using the Storage Account</h3>
<p>The overwatch output storage account may be accessed directly via:</p>
<ul>
<li>abfss://</li>
<li>wasbs:// (not supported)</li>
<li>A mounted filed system within Databricks. More information on mounting storage accounts can be found
<a href="https://docs.databricks.com/data/data-sources/azure/adls-gen2/azure-datalake-gen2-sp-access.html#access-azure-data-lake-storage-gen2-using-oauth-20-with-an-azure-service-principal">here</a>.</li>
</ul>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/gcp/" title="GCP"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://databrickslabs.github.io/overwatch/deployoverwatch/cloudinfra/aws/" title="AWS" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://databrickslabs.github.io/overwatch/js/clipboard.min.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.min.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.jquery.min.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/jquery.sticky.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/featherlight.min.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/highlight.pack.js?1706289040"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://databrickslabs.github.io/overwatch/js/modernizr.custom-3.6.0.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/learn.js?1706289040"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/hugo-learn.js?1706289040"></script>

    <link href="https://databrickslabs.github.io/overwatch/mermaid/mermaid.css?1706289040" rel="stylesheet" />
    <script src="https://databrickslabs.github.io/overwatch/mermaid/mermaid.js?1706289040"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

