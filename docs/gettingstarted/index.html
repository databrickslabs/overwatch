<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="Overwatch Documentation">
<meta name="author" content="Daniel Tomes -- DatabricksLabs">

    <link rel="icon" href="https://databrickslabs.github.io/overwatch/images/favicon.png" type="image/png">

    <title>Getting Started :: Overwatch</title>

    
    <link href="https://databrickslabs.github.io/overwatch/css/nucleus.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/fontawesome-all.min.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hybrid.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/featherlight.min.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/perfect-scrollbar.min.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/auto-complete.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/atom-one-dark-reasonable.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/theme.css?1667325296" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hugo-theme.css?1667325296" rel="stylesheet">
    
    <link href="https://databrickslabs.github.io/overwatch/css/theme-blue.css?1667325296" rel="stylesheet">
    
    

    <script src="https://databrickslabs.github.io/overwatch/js/jquery-3.3.1.min.js?1667325296"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

<script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="" data-url="https://databrickslabs.github.io/overwatch/gettingstarted/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://databrickslabs.github.io/overwatch/">
    <img src="https://databrickslabs.github.io/overwatch/images/tmp_logo4.png", width="85%">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/lunr.min.js?1667325296"></script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/auto-complete.js?1667325296"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/databrickslabs.github.io\/overwatch\/";
    
</script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/search.js?1667325296"></script>

    
  </div>
  
  <section id="homelinks">
    <ul>
      <li>
        <a class="padding" href='https://databrickslabs.github.io/overwatch/'><i class='fas fa-home'></i> Home</a>
      </li>
    </ul>
  </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/gettingstarted/" title="Getting Started" class="dd-item
        parent
        active
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/gettingstarted/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/gettingstarted/configuration/" title="Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/gettingstarted/modules/" title="Modules" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/gettingstarted/modules/">
        Modules
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/gettingstarted/advancedtopics/" title="Advanced Topics" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/gettingstarted/advancedtopics/">
        Advanced Topics
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/environmentsetup/" title="Environment Setup" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/environmentsetup/">
          Environment Setup
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/environmentsetup/azure/" title="Azure" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/environmentsetup/azure/">
        Azure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/environmentsetup/aws/" title="AWS" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/environmentsetup/aws/">
        AWS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dataengineer/" title="Data Engineering" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/">
          Data Engineering
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/dataengineer/definitions/" title="Data Dictionary (Latest)" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions/">
          Data Dictionary (Latest)
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/definitions/061x/" title="Data Dictionary - 0.6.1.x" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions/061x/">
        Data Dictionary - 0.6.1.x
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/pipeline_management/" title="Pipeline_Management" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/pipeline_management/">
        Pipeline_Management
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/upgrade/" title="Upgrade" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/upgrade/">
        Upgrade
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/productionizing/" title="Productionizing" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/productionizing/">
        Productionizing
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/changelog/" title="ChangeLog" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/changelog/">
          ChangeLog
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/faq/" title="FAQ" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/faq/">
          FAQ
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/contributing/" title="" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/contributing/">
          
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <center>

    
    <a class="github-button" href="https://github.com/databrickslabs/overwatch/subscription"
       data-icon="octicon-eye" data-show-count="true" aria-label="Watch Overwatch on GitHub">Watch</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch" data-icon="octicon-star" data-show-count="true" aria-label="Star databrickslabs/overwatch on GitHub">Star</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch/fork"
       data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Overwatch on GitHub">Fork</a>

    <p>A <a href="https://github.com/databrickslabs">Databricks Labs</a> project.</p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='https://databrickslabs.github.io/overwatch/'>Welcome To OverWatch</a> > Getting Started
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#how-it-works">How It Works</a></li>
    <li><a href="#run-methods">Run Methods</a></li>
    <li><a href="#cluster-requirements">Cluster Requirements</a>
      <ul>
        <li><a href="#cluster-dependencies">Cluster Dependencies</a></li>
        <li><a href="#cluster-config-recommendations">Cluster Config Recommendations</a></li>
        <li><a href="#notes-on-autoscaling">Notes On Autoscaling</a></li>
      </ul>
    </li>
    <li><a href="#environment-setup">Environment Setup</a>
      <ul>
        <li></li>
        <li><a href="#initializing-the-environment">Initializing the Environment</a></li>
        <li><a href="#executing-the-pipeline">Executing The Pipeline</a></li>
        <li><a href="#via-a-notebook">Via A Notebook</a></li>
        <li><a href="#via-main-class">Via Main Class</a></li>
        <li><a href="#configuring-custom-costs">Configuring Custom Costs</a></li>
        <li><a href="#overwatch-scopes">Overwatch Scopes</a></li>
        <li><a href="#security-considerations">Security Considerations</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Getting Started
            </h1>
          

        



	<h2 id="how-it-works">How It Works</h2>
<ul>
<li>Build the Config (json string)
<ul>
<li>The notebooks below are designed to simplify this and offer some basic best practices for constructed paths</li>
</ul>
</li>
<li>Instantiate Overwatch&rsquo;s <em>workspace</em> object</li>
<li>Use the <em>workspace</em> object to run the Pipelines (i.e. Bronze/Silver/Gold)
<ul>
<li>e.g. - Bronze(workspace).run()</li>
</ul>
</li>
</ul>
<h2 id="run-methods">Run Methods</h2>
<p>Overwatch is run via one of two methods:</p>
<ol>
<li>As a job controlling <a href="#via-a-notebook"><strong>running a notebook</strong></a>
<ul>
<li><a href="#jump-start-notebooks">Quick Link to Runner Notebooks</a></li>
</ul>
</li>
<li>As a job running the <a href="#via-main-class"><strong>main class</strong></a></li>
</ol>
<p>Below are instructions for both methods. The primary difference is the way by which the
<a href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration/">configuration</a> is implemented and the choice of which to use is
entirely user preference. Overwatch is meant to control itself from soup to nuts meaning it creates its own databases
and tables and manages all spark parameters and optimization requirements to operate efficiently. Beyond the config
and the job run setup, Overwatch runs best as a black box &ndash; enable it and forget about it.</p>
<h2 id="cluster-requirements">Cluster Requirements</h2>
<ul>
<li>DBR 10.4LTS as of 0.6.1
<ul>
<li>Overwatch will likely run on later versions but is built and tested on 10.4LTS since 0.6.1</li>
<li>Overwatch &lt; 0.6.1 &ndash; DBR 9.1LTS</li>
<li>Overwatch version 0.6.1+ &ndash; DBR 10.4LTS</li>
</ul>
</li>
<li>Do not use Photon
<ul>
<li>Photon optimization will begin with DBR 11.x LTS please wait on photon</li>
</ul>
</li>
<li>Disable Autoscaling - See <a href="#notes-on-autoscaling">Notes On Autoscaling</a>
<ul>
<li>External optimize cluster recommendations are different.
See <a href="https://databrickslabs.github.io/overwatch/gettingstarted/advancedtopics//#externalize-optimize--z-order-as-of-060">External Optimize</a> for more details</li>
</ul>
</li>
<li>Add the relevant <a href="#cluster-dependencies">dependencies</a></li>
</ul>
<h3 id="cluster-dependencies">Cluster Dependencies</h3>
<p>Add the following dependencies to your cluster</p>
<ul>
<li>Overwatch Assembly (fat jar): <code>com.databricks.labs:overwatch_2.12:&lt;latest&gt;</code></li>
<li><strong>(Azure Only)</strong> azure-eventhubs-spark - integration with Azure EventHubs
<ul>
<li>Maven Coordinate: <code>com.microsoft.azure:azure-eventhubs-spark_2.12:2.3.21</code></li>
</ul>
</li>
</ul>
<h3 id="cluster-config-recommendations">Cluster Config Recommendations</h3>
<ul>
<li>Azure
<ul>
<li>Node Type (Driver &amp; Worker) - Standard_D16s_v3
<ul>
<li>Use n Standard_E*d[s]_v4 for workers for historical loads</li>
<li>Large / Very Large workspaces may see a significant improvement using Standard_E16d[s]_v4 workers but mileage varies, cost/benefit analysis required</li>
</ul>
</li>
<li>Node Count - 2
<ul>
<li>This may be increased if necessary but note that bronze is not linearly scalable; thus, increasing core count 
may not improve runtimes. Please see <a href="https://databrickslabs.github.io/overwatch/gettingstarted/advancedtopics//#optimizing-overwatch">Optimizing Overwatch</a> for more information.</li>
</ul>
</li>
</ul>
</li>
<li>AWS
<ul>
<li>Node Type (Driver &amp; Worker) - R5.4xlarge
<ul>
<li>Use n i3.*xlarge for workers for historical loads</li>
<li>Large / Very Large workspaces may see a significant improvement using i3.4xlarge workers but mileage varies, cost/benefit analysis required</li>
</ul>
</li>
<li>Node Count - 2
<ul>
<li>This may be increased if necessary but note that bronze is not linearly scalable; thus, increasing core count
may not improve runtimes. Please see <a href="https://databrickslabs.github.io/overwatch/gettingstarted/advancedtopics//#optimizing-overwatch">Optimizing Overwatch</a> for more information.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="notes-on-autoscaling">Notes On Autoscaling</h3>
<ul>
<li>Auto-scaling compute &ndash; <strong>Not Recommended</strong>
<ul>
<li>Note that autoscaling compute will not be extremely efficient due to some of the compute tails
as a result of log file size skew and storage mediums. Additionally, some modules require thousands of API calls
(for historical loads) and have to be throttled to protect the workspace.</li>
</ul>
</li>
<li>Auto-scaling Local Storage &ndash; <strong>Strongly Recommended</strong> for historical loads
<ul>
<li>Some of the data sources can grow to be quite large and require very large shuffle stages which requires
sufficient local disk. If you choose not to use auto-scaling storage be sure you provision sufficient local
disk space.
<ul>
<li>SSD or NVME (preferred) &ndash; It&rsquo;s strongly recommended to use fast local disks as there can be very large shuffles</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="environment-setup">Environment Setup</h2>
<p>There are some basic environment configuration steps that need to be enabled to allow Overwatch to do its job.</p>
<p>These activities include things like <a href="https://docs.databricks.com/administration-guide/account-settings/audit-logs.html">enabling Audit Logs</a>, setting up security (as desired), etc. The setup activities
are slightly different depending on your cloud provider, currently Overwatch can operate on
<a href="https://databrickslabs.github.io/overwatch/environmentsetup/aws/"><strong>aws</strong></a> and <a href="https://databrickslabs.github.io/overwatch/environmentsetup/azure/"><strong>azure</strong></a>. Please
reference the page that&rsquo;s relevant for your deployment.</p>
<h4 id="estimated-spot-prices">Estimated Spot Prices</h4>
<p>Overwatch doesn&rsquo;t automatically estimate or calculate spot prices. If spot price estimation is desired, best practice 
is to review the historical spot prices by node in your region and create a lookup table for referencing node type 
by historical spot price detail. This will have to be manually discounted from compute costs later.</p>
<h3 id="initializing-the-environment">Initializing the Environment</h3>
<p>It&rsquo;s best to run the first initialize command manually to validate the configuration and ensure the costs are built
as desired. This should only be completed one time per target database (often many workspaces to one 
target database, the targets are then mounted on several workspaces to which they are appended by the Overwatch 
processes).</p>
<p>In a notebook, run the following commands (customized for your needs of course) to initialize the targets. For 
additional details on config customization options see <a href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration/"><strong>configuration</strong></a>.</p>
<h4 id="jump-start-notebooks">Jump Start Notebooks</h4>
<p>The following notebooks will demonstrate a typical best practice for multi-workspace (and stand-alone) configurations. 
Simply populate the necessary variables for your environment.</p>
<ul>
<li>AZURE (<a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/azure_runner_docs_example_070.html">HTML 0.7.0+</a> / <a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/azure_runner_docs_example_070.dbc">DBC 0.7.0+</a>)</li>
<li>AWS (<a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/aws_runner_docs_example_070.html">HTML 0.7.0+</a> / <a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/aws_runner_docs_example_070.dbc">DBC 0.7.0+</a>)</li>
<li>AZURE (<a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/azure_runner_docs_example_060.html">HTML 0.6.0+</a> / <a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/azure_runner_docs_example_060.dbc">DBC 0.6.0+</a>)</li>
<li>AWS (<a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/aws_runner_docs_example_060.html">HTML 0.6.0+</a> / <a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/aws_runner_docs_example_060.dbc">DBC 0.6.0+</a>)</li>
<li>AZURE (<a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/azure_runner_docs_example_0504.html">HTML 0.5.0.4+</a> / <a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/azure_runner_docs_example_0504.dbc">DBC 0.5.0.4+</a>)</li>
<li>AWS (<a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/aws_runner_docs_example_042.html">HTML 0.5.x</a> / <a href="https://databrickslabs.github.io/overwatch/assets/GettingStarted/aws_runner_docs_example_042.dbc">DBC 0.5.x</a>)</li>
</ul>
<p>The code snippet below will initialize the workspace (simple aws example).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> storagePrefix <span style="color:#66d9ef">=</span> <span style="color:#e6db74">&#34;/mnt/global/Overwatch/working/directory&#34;</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> workspaceID <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span> <span style="color:#75715e">//automatically generated in the runner scripts referenced above
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> dataTarget <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">DataTarget</span><span style="color:#f92672">(</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>etlDB<span style="color:#f92672">),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">${</span>storagePrefix<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>workspaceID<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>etlDB<span style="color:#e6db74">}</span><span style="color:#e6db74">.db&#34;</span><span style="color:#f92672">),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">${</span>storagePrefix<span style="color:#e6db74">}</span><span style="color:#e6db74">/global_share&#34;</span><span style="color:#f92672">),</span>
  <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>consumerDB<span style="color:#f92672">),</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">${</span>storagePrefix<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>workspaceID<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>consumerDB<span style="color:#e6db74">}</span><span style="color:#e6db74">.db&#34;</span><span style="color:#f92672">)</span>
<span style="color:#f92672">)</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> tokenSecret <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">TokenSecret</span><span style="color:#f92672">(</span>secretsScope<span style="color:#f92672">,</span> dbPATKey<span style="color:#f92672">)</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> badRecordsPath <span style="color:#66d9ef">=</span> <span style="color:#e6db74">s&#34;</span><span style="color:#e6db74">${</span>storagePrefix<span style="color:#e6db74">}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">${</span>workspaceID<span style="color:#e6db74">}</span><span style="color:#e6db74">/sparkEventsBadRecords&#34;</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> auditSourcePath <span style="color:#66d9ef">=</span> <span style="color:#e6db74">&#34;/path/to/my/workspaces/raw_audit_logs&#34;</span> <span style="color:#75715e">// INPUT: workspace audit log directory
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> interactiveDBUPrice <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">0.56</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> automatedDBUPrice <span style="color:#66d9ef">=</span> <span style="color:#ae81ff">0.26</span>
<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> customWorkspaceName <span style="color:#66d9ef">=</span> workspaceID <span style="color:#75715e">// customize this to a custom name if custom workspace_name is desired
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">val</span> params <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">OverwatchParams</span><span style="color:#f92672">(</span>
  auditLogConfig <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">AuditLogConfig</span><span style="color:#f92672">(</span>rawAuditPath <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>auditSourcePath<span style="color:#f92672">)),</span>
  dataTarget <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>dataTarget<span style="color:#f92672">),</span>
  tokenSecret <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>tokenSecret<span style="color:#f92672">),</span>
  badRecordsPath <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>badRecordsPath<span style="color:#f92672">),</span>
  overwatchScope <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>scopes<span style="color:#f92672">),</span>
  maxDaysToLoad <span style="color:#66d9ef">=</span> maxDaysToLoad<span style="color:#f92672">,</span>
  databricksContractPrices <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">DatabricksContractPrices</span><span style="color:#f92672">(</span>interactiveDBUPrice<span style="color:#f92672">,</span> automatedDBUPrice<span style="color:#f92672">),</span>
  primordialDateString <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>primordialDateString<span style="color:#f92672">),</span>
  workspace_name <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>customWorkspaceName<span style="color:#f92672">),</span> <span style="color:#75715e">// as of 0.6.0
</span><span style="color:#75715e"></span>  externalizeOptimize <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">false</span> <span style="color:#75715e">// as of 0.6.0
</span><span style="color:#75715e"></span><span style="color:#f92672">)</span>

<span style="color:#75715e">// args are the full json config to be used for the Overwatch workspace deployment
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> args <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">JsonUtils</span><span style="color:#f92672">.</span>objToJson<span style="color:#f92672">(</span>params<span style="color:#f92672">).</span>compactString

<span style="color:#75715e">// the workspace object contains everything Overwatch needs to build, run, maintain its pipelines
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> workspace <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Initializer</span><span style="color:#f92672">(</span>args<span style="color:#f92672">)</span> <span style="color:#75715e">// 0.5.x+
</span></code></pre></div><p>If this is the first run and you&rsquo;d like to <strong>customize compute costs</strong> to mirror your region / contract price, be sure to 
run the following to initialize the pipeline which will in turn create some costing tables, which you can customize 
according to your needs. This is only necessary for first-time init with custom costs. More information below 
in the <a href="#configuring-custom-costs"><strong>Configuring Custom Costs</strong></a> section.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#a6e22e">Bronze</span><span style="color:#f92672">(</span>workspace<span style="color:#f92672">)</span>
</code></pre></div><p>This is also a great time to materialize the JSON configs for use in the Databricks job the main class (not notebook) 
is to be used to execute the job.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> escapedConfigString <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">JsonUtils</span><span style="color:#f92672">.</span>objToJson<span style="color:#f92672">(</span>params<span style="color:#f92672">).</span>escapedString <span style="color:#75715e">// used for job runs using main class
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> compactConfigString <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">JsonUtils</span><span style="color:#f92672">.</span>objToJson<span style="color:#f92672">(</span>params<span style="color:#f92672">).</span>compactString <span style="color:#75715e">// used to instantiate workspace in a notebook
</span><span style="color:#75715e"></span><span style="color:#66d9ef">val</span> prettyConfigString <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">JsonUtils</span><span style="color:#f92672">.</span>objToJson<span style="color:#f92672">(</span>params<span style="color:#f92672">).</span>prettyString <span style="color:#75715e">// human-readable json config 
</span></code></pre></div><p>The target database[s] (defined in the <em>dataTarget</em> variable above) should now be visible from the data tab 
in Databricks. Additionally, the ETL database 
should contain the custom costing tables, 
<a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions//#instancedetails">instanceDetails</a> and 
<a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions//#dbucostdetails">dbuCostDetails</a>. This is a good time 
to <a href="#configuring-custom-costs">customize compute prices</a> if you so desire; after first init but before first pipeline run.</p>
<h3 id="executing-the-pipeline">Executing The Pipeline</h3>

<div class="notices info" ><p>Don&rsquo;t load years worth of data on your first attempt. There are very simple 
<a href="https://databrickslabs.github.io/overwatch/faq//##q1-how-to-clean-re-deploy">workspace cleanup scripts</a> in the docs
to allow you to quickly start fresh. Best practice is to load the latest 5 or so days (i.e. set primordial date to
today minus 5) and let the entire pipeline run, review the pipReport and validate everything. If all looks good,
now you can begin your historical loading journey. <strong>NOTE</strong> cluster events are only available for 30 days thus
<em>clusterStateFact</em> and <em>jobRunCostPotentialFact</em> will not load for data older than 30 days.</p>
</div>

<h3 id="via-a-notebook">Via A Notebook</h3>
<p>Now that we understand our config and have a valid workspace object, the Overwatch pipeline can be run. It&rsquo;s often 
a good idea to run the first run from a notebook to validate the configuration and the pipeline.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> args <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">JsonUtils</span><span style="color:#f92672">.</span>objToJson<span style="color:#f92672">(</span>params<span style="color:#f92672">).</span>compactString
<span style="color:#66d9ef">val</span> workspace <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Initializer</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Array</span><span style="color:#f92672">(</span>args<span style="color:#f92672">),</span> debugFlag <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>

<span style="color:#a6e22e">Bronze</span><span style="color:#f92672">(</span>workspace<span style="color:#f92672">).</span>run<span style="color:#f92672">()</span>
<span style="color:#a6e22e">Silver</span><span style="color:#f92672">(</span>workspace<span style="color:#f92672">).</span>run<span style="color:#f92672">()</span>
<span style="color:#a6e22e">Gold</span><span style="color:#f92672">(</span>workspace<span style="color:#f92672">).</span>run<span style="color:#f92672">()</span>
</code></pre></div><h3 id="via-main-class">Via Main Class</h3>

<div class="notices note" ><p><strong>AZURE</strong> Must use version 0.5.0.4 or later so as not to pass EH connection string credentials into arguments in 
clear text.</p>
</div>

<p>The Main class version does the same thing as the notebook version the difference is just how it&rsquo;s kicked off and
configured. The tricky party about the main class is that the parameters must be passed in as a json array of 
escaped strings (this is why the JsonUtils above have the option for <em>escapedString</em>. 
The &ldquo;OverwatchParams&rdquo; object gets serialized and passed into the args of the Main Class. To
simplify the creation of this string simply follow the example above <a href="#initializing-the-environment">Initializing The Environment</a>
and use the <em>escapedConfigString</em>. Now that you have the string, setup the job with that string as the Parameters. 
The Main Class for historical batch is <code>com.databricks.labs.overwatch.BatchRunner</code><!-- raw HTML omitted --></p>
<p>Notice that the escaped Overwatch Json config goes inside the array of strings parameter config</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[<span style="color:#e6db74">&#34;&lt;overwatch_escaped_params&gt;&#34;</span>]
[<span style="color:#e6db74">&#34;bronze&#34;</span>, <span style="color:#e6db74">&#34;&lt;overwatch_escaped_params&gt;&#34;</span>]
[<span style="color:#e6db74">&#34;silver&#34;</span>, <span style="color:#e6db74">&#34;&lt;overwatch_escaped_params&gt;&#34;</span>]
[<span style="color:#e6db74">&#34;gold&#34;</span>, <span style="color:#e6db74">&#34;&lt;overwatch_escaped_params&gt;&#34;</span>]
</code></pre></div>
<div class="notices info" ><p><strong>If a single argument</strong> passed to main class: Arg(0) is Overwatch Parameters json string (escaped if sent through API).
<strong>If TWO arguments</strong> are passed to main class: Arg(0) must be &lsquo;bronze&rsquo;, &lsquo;silver&rsquo;, or &lsquo;gold&rsquo; corresponding to the 
Overwatch Pipeline layer you want to be run. Arg(1) will be the Overwatch Parameters json string.</p>
</div>

<p><img src="https://databrickslabs.github.io/overwatch/images/GettingStarted/0601JobSetupExample.png" alt="newUIJarSetup"></p>
<h3 id="configuring-custom-costs">Configuring Custom Costs</h3>
<p>There are three essential components to the cost function:</p>
<ul>
<li>The node type and its associated contract price</li>
<li>The node type and its associated DBUs per hour</li>
<li>The DBU contract prices for the SKU under which your DBUs are charged such as:
<ul>
<li>Interactive</li>
<li>Automated</li>
<li>DatabricksSQL</li>
<li>JobsLight</li>
</ul>
</li>
</ul>
<p>The DBU contract costs are captured from the
<a href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration//#databrickscontractprices">Overwatch Configuration</a> maintained
as a slow-changing-dimension in the <a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions//#dbucostdetails">dbuCostDetails table</a>.
The compute costs and dbu to node
associations are maintained as a slow-changing-dimension in the
<a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions//#instancedetails">instanceDetails</a> table.</p>
<ul>
<li><strong>IMPORTANT</strong> These tables are automatically created in the dataTarget upon first initialization of the pipeline.</li>
<li><strong>DO NOT</strong> try to manually create the target database outside of Overwatch as that will lead to database validation errors.</li>
</ul>
<p><strong>To customize costs</strong> generate the workspace object as demonstrated in the <a href="#jump-start-notebooks">Jump Start Notebooks</a>
above. Once the configs are built out and the workspace object is ready, the Bronze pipeline can be instantiated
(but not ran) to initialize the custom cost tables for customization.</p>
<p>Note that each subsequent workspace referencing the same dataTarget will append default compute prices to instanceDetails
table if no data is present for that organization_id (i.e. workspace).
If you would like to customize compute costs for all workspaces,<br>
export the instanceDetails dataset to external editor (after first init), add the required metrics referenced above
for each workspace, and update the target table with the customized cost information. Note that the instanceDetails
object in the consumer database is just a view so you must edit/overwrite the underlying table in the ETL database. The view
will automatically be recreated upon first pipeline run.</p>
<p><strong>IMPORTANT</strong> These cost tables are slow-changing-dimensions and thus they have specific rule requirements; familiarize
yourself with the details at the links below. If the rules fail, the Gold Pipeline will fail with specific costing
errors to help you resolve it.</p>
<ul>
<li><a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions//#instancedetails">InstanceDetails Table Details</a></li>
<li><a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions//#dbucostdetails">dbuCostDetails Table Details</a></li>
</ul>
<p><a href="https://azureprice.net/">Helpful Tool (AZURE_Only)</a> to get pricing by region by node.</p>
<p>Sample compute details available below. These are only meant for reference, they do not have all required fields.
Follow the instruction above for how to implement custom costs.


<a href="https://drive.google.com/file/d/1tj0GV-vX1Ka9cRcJpJSwkQx6bbpueSwl/view?usp=sharing" target="_blank">AWS Example</a>
 |


<a href="https://drive.google.com/file/d/13hYZrOAmzLwIjfgNz0YWx-qE2TdWe0-c/view?usp=sharing" target="_blank">Azure Example</a>
</p>
<h3 id="overwatch-scopes">Overwatch Scopes</h3>
<p>The Overwatch parameters take in <em>scopes</em> which reference an abstract Databricks component that can be 
enabled/disabled for Overwatch observability. If a scope such as <em>jobs</em> is disabled, none of the bronze/silver/gold 
modules that materialize databricks jobs will be created. Furthermore, neither will any of their dependencies. For 
example, if jobs is disabled, jobs, jobRuns and jobRunCostPotentialFact will all be missing from the data model as 
they were disabled. It&rsquo;s recommended to just leave them all enabled unless there&rsquo;s a specific need to disable a scope.
For more information on scopes and modules please refer to <a href="https://databrickslabs.github.io/overwatch/gettingstarted/modules/">Modules</a></p>
<h3 id="security-considerations">Security Considerations</h3>
<h4 id="overwatch-read-requirements">Overwatch Read Requirements</h4>
<p>The account that owns/runs the Overwatch process must have access to read all objects that are desired to be 
captured in the Overwatch Data Model. For example, if jobs,clusters,pools modules are enabled, it&rsquo;s imperative that 
the Overwatch user have access to read the jobs, job runs, clusters, and pools and their histories and definitions to 
properly populate the Overwatch data model. The same is true with regard to input/output paths, Overwatch must have 
access to all configured input/output paths.</p>
<h4 id="overwatch-output-data">Overwatch Output Data</h4>
<p>Overwatch, by default, will create a single database that, is accessible to everyone in your organization unless you
specify a location for the database in the configuration that is secured. Several of the modules
capture fairly sensitive data such as users, userIDs, etc. It is suggested that the configuration specify two
databases in the configuration:</p>
<ul>
<li><strong>ETL database</strong> &ndash; hold all raw and intermediate transform entities. This database can be secured
allowing only the necessary data engineers direct access.</li>
<li><strong>Consumer database</strong> &ndash; Holds views only and is easy to secure using Databricks' table ACLs (assuming no direct
scala access). The consumer database holds only views that point to tables so additional security can easily be
attributed at this layer.</li>
</ul>
<p>For more information on how to configure the separation of ETL and consumption databases, please reference the
<a href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration/"><strong>configuration</strong></a> page.</p>
<p>Additional steps can be taken to secure the storage location of the ETL entities as necessary. The method for
securing access to these tables would be the same as with any set of tables in your organization.</p>
<h4 id="accessing-the-secrets">Accessing the Secret[s]</h4>
<p>The owner of the Overwatch Run must have access to the secret[s] that store the sensitive info. For example,
if John runs a notebook, John must have access to the secrets used in the config. The same is true if John
creates a scheduled job and sets it to run on a schedule. This changes when it goes to production though and John
sends it through production promotion process and the job is now owned by the etl-admin principle. Since the job
is now owned by the etl-admin principle, etl-admin must have access to the relevant secrets.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="https://databrickslabs.github.io/overwatch/" title="Welcome To OverWatch"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration/" title="Configuration" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://databrickslabs.github.io/overwatch/js/clipboard.min.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.min.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.jquery.min.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/jquery.sticky.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/featherlight.min.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/highlight.pack.js?1667325296"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://databrickslabs.github.io/overwatch/js/modernizr.custom-3.6.0.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/learn.js?1667325296"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/hugo-learn.js?1667325296"></script>

    <link href="https://databrickslabs.github.io/overwatch/mermaid/mermaid.css?1667325296" rel="stylesheet" />
    <script src="https://databrickslabs.github.io/overwatch/mermaid/mermaid.js?1667325296"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
