<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.76.5" />
    <meta name="description" content="Overwatch Documentation">
<meta name="author" content="Daniel Tomes -- DatabricksLabs">

    <link rel="icon" href="https://databrickslabs.github.io/overwatch/images/favicon.png" type="image/png">

    <title>Azure :: Overwatch</title>

    
    <link href="https://databrickslabs.github.io/overwatch/css/nucleus.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/fontawesome-all.min.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hybrid.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/featherlight.min.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/perfect-scrollbar.min.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/auto-complete.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/atom-one-dark-reasonable.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/theme.css?1619119001" rel="stylesheet">
    <link href="https://databrickslabs.github.io/overwatch/css/hugo-theme.css?1619119001" rel="stylesheet">
    
    <link href="https://databrickslabs.github.io/overwatch/css/theme-blue.css?1619119001" rel="stylesheet">
    
    

    <script src="https://databrickslabs.github.io/overwatch/js/jquery-3.3.1.min.js?1619119001"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    

<script async defer src="https://buttons.github.io/buttons.js"></script>
  </head>
  <body class="" data-url="https://databrickslabs.github.io/overwatch/environmentsetup/azure/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://databrickslabs.github.io/overwatch/">
    <img src="https://databrickslabs.github.io/overwatch/images/tmp_logo4.png", width="85%">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/lunr.min.js?1619119001"></script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/auto-complete.js?1619119001"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/databrickslabs.github.io\/overwatch\/";
    
</script>
<script type="text/javascript" src="https://databrickslabs.github.io/overwatch/js/search.js?1619119001"></script>

    
  </div>
  
  <section id="homelinks">
    <ul>
      <li>
        <a class="padding" href='https://databrickslabs.github.io/overwatch/'><i class='fas fa-home'></i> Home</a>
      </li>
    </ul>
  </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/gettingstarted/" title="Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/gettingstarted/">
          Getting Started
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/gettingstarted/configuration/" title="Configuration" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/gettingstarted/configuration/">
        Configuration
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/gettingstarted/modules/" title="Modules" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/gettingstarted/modules/">
        Modules
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/gettingstarted/advancedtopics/" title="Advanced Topics" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/gettingstarted/advancedtopics/">
        Advanced Topics
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/environmentsetup/" title="Environment Setup" class="dd-item
        parent
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/environmentsetup/">
          Environment Setup
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/environmentsetup/azure/" title="Azure" class="dd-item active">
        <a href="https://databrickslabs.github.io/overwatch/environmentsetup/azure/">
        Azure
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/environmentsetup/aws/" title="AWS" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/environmentsetup/aws/">
        AWS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/dataengineer/" title="Data Engineering" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/dataengineer/">
          Data Engineering
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/definitions/" title="Definitions" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/definitions/">
        Definitions
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/dataengineer/etl_process/" title="ETL Process" class="dd-item ">
        <a href="https://databrickslabs.github.io/overwatch/dataengineer/etl_process/">
        ETL Process
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/contributing/" title="" class="dd-item
        
        
        
        ">
      <a href="https://databrickslabs.github.io/overwatch/contributing/">
          
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      <center>

    
    <a class="github-button" href="https://github.com/databrickslabs/overwatch/subscription"
       data-icon="octicon-eye" data-show-count="true" aria-label="Watch Overwatch on GitHub">Watch</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch" data-icon="octicon-star" data-show-count="true" aria-label="Star databrickslabs/overwatch on GitHub">Star</a>


    <a class="github-button" href="https://github.com/databrickslabs/overwatch/fork"
       data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork Overwatch on GitHub">Fork</a>

    <p>A <a href="https://github.com/databrickslabs">Databricks Labs</a> project.</p>
</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://databrickslabs.github.io/overwatch/'>Welcome To OverWatch</a> > <a href='https://databrickslabs.github.io/overwatch/environmentsetup/'>Environment Setup</a> > Azure
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#configuring-overwatch-on-azure-databricks">Configuring Overwatch on Azure Databricks</a>
      <ul>
        <li><a href="#configuring-the-event-hub-for-audit-log-delivery">Configuring the Event Hub For Audit Log Delivery</a></li>
        <li><a href="#configuing-the-event-hub">Configuing The Event Hub</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Azure
            </h1>
          

        


<h2 id="configuring-overwatch-on-azure-databricks">Configuring Overwatch on Azure Databricks</h2>
<p>Reach out to your Customer Success Engineer (CSE) to help you with these tasks as needed.
<!-- raw HTML omitted -->
To get started, the <a href="#configuring-the-event-hub-for-audit-log-delivery">Basic Deployment</a> configuration. 
As more modules are enabled, additional environment configuration may be required in addition to the Basic Deployment.</p>
<p>There are two primary sources of data that need to be configured:</p>
<ul>
<li>Audit Logs
<ul>
<li>These will be delivered through Event Hubs. The audit logs contain data for every interaction within the environment 
and are used to track the state of various objects through time along with which accounts interacted with them. This data
is relatively small and it certainly doesn&rsquo;t contain any large data sets like cluster/spark logs.</li>
</ul>
</li>
<li>Cluster Logs - Crucial to get the most out of Overwatch
<ul>
<li>These logs can get quite large and they are stored in a very inefficient format for query and long-term storage.
This is why it&rsquo;s crucial to create a dedicated storage account for these and ensure TTL (time-to-live) is enabled
to minimize long-term, unnecessary costs.
It&rsquo;s not recommended to store these on DBFS directly (dbfs mount points are ok).</li>
<li>Best Practice - Multi-Workspace &ndash; When multiple workspaces are using Overwatch within a single region it&rsquo;s best to
ensure that each are going to their own prefix, even if sharing a storage account. This greatly reduces Overwatch scan times
as the log files build up. If scan times get too long, the TTL can be reduced or additional storage accounts can 
be created to increase read IOPS throughput (rarely necessary) intra-region.</li>
</ul>
</li>
</ul>
<p><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/Cluster_Logs_Azure.png" alt="AzureClusterLogging"></p>
<table>
<thead>
<tr>
<th>Basic Deployment</th>
<th>Multi-Region Deployment</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/Overwatch_Arch_Simple_Azure.png" alt="BasicAzureArch"></td>
<td><img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/Overwatch_Arch_Azure.png" alt="AzureArch"></td>
</tr>
</tbody>
</table>
<h3 id="configuring-the-event-hub-for-audit-log-delivery">Configuring the Event Hub For Audit Log Delivery</h3>
<ul>
<li>Audit Log Delivery
<ul>
<li>At present the only supported method for audit log delivery is through Eventhub delivery via Azure Diagnostic Logging. 
Overwatch will consume the events as a batch stream (Trigger.Once) once/period when the job runs. To configure 
Eventhub to deliver these logs, follow the steps below.</li>
</ul>
</li>
</ul>
<h3 id="configuing-the-event-hub">Configuing The Event Hub</h3>
<h4 id="step-1">Step 1</h4>
<p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-create">Create or reuse an Event Hub namespace.</a>

<div class="notices warning" ><p><strong>Tht Event Hub Namespace MUST be in the same location as your control plane</strong></p>
</div>
</p>

<div class="notices info" ><p>If you select the &ldquo;Basic&rdquo; Pricing Tier, just note that you will be required to ensure at least two successful 
Overwatch runs per day to ensure there won&rsquo;t be data loss. This is because message retention is 1 day meaning that 
data expires out of EH every 24 hours. &ldquo;Standard&rdquo; Pricing tier doesn&rsquo;t cost much more but 
it will give you up to 7 days retention which is much safer if you grow dependent on Overwatch reports.</p>
</div>


<div class="notices info" ><p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-scalability#throughput-units"><strong>Throughput Units</strong></a> 
In almost all cases, 1 static throughput unit is sufficient for Overwatch. Cases where this may not be true are 
include cases where there are many users across many workspaces sharing a single EH Namespace.
Review the Throughput Units sizing and make the best decision for you.</p>
</div>

<p>Inside the namespace create an Event Hub</p>
<h4 id="step-2">Step 2</h4>
<p>Create an Event Hub inside your chosen (or created) EH Namespace.

<div class="notices info" ><p><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-scalability#partitions"><strong>Partitions</strong></a>
The maximum number of cores (parallelism) that can simultaneously pull data from your event hub == EH partitions.
In most cases this should be set to 32. It can be fewer, just be sure that Overwatch uses an autoscaling cluster
to minimize costs while waiting to pull the data from EH. For example, if Overwatch is pulling 30 million events 
but only has 8 partitions, any worker cores over 8 will sit idle while all 30 million events are retrieved. In a 
situation like this, the minimum autoscaling compute size should approximately equal the number of partitions to 
minimize waste.</p>
</div>
</p>
<h4 id="step-3">Step 3</h4>
<p>With your Event Hub created and ready to go, Navigate to your the Azure Databricks workspace[s] for which you&rsquo;d like 
to enable Overwatch. Under Monitoring section &ndash;&gt; Diagnostics settings &ndash;&gt; Add diagnostic setting. Configure 
your log delivery similar to the example in the image below.</p>
<p>Additionally, ensure that the Overwatch account has sufficinet privileges to read data from the Event Hub[s] created
above. A common method for providing Overwatch access to the Event Hub is to simply capture the connection string 
and store it as a <a href="https://docs.databricks.com/security/secrets/index.html">secret</a>. 
There are many methods through which to authorize Overwatch, just ensure it has the access to read from the Event Hub Stream.
<img src="https://databrickslabs.github.io/overwatch/images/EnvironmentSetup/EH_BaseConfig.png" alt="EH_Base_Setup"></p>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="https://databrickslabs.github.io/overwatch/environmentsetup/" title="Environment Setup"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://databrickslabs.github.io/overwatch/environmentsetup/aws/" title="AWS" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://databrickslabs.github.io/overwatch/js/clipboard.min.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.min.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/perfect-scrollbar.jquery.min.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/jquery.sticky.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/featherlight.min.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/highlight.pack.js?1619119001"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://databrickslabs.github.io/overwatch/js/modernizr.custom-3.6.0.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/learn.js?1619119001"></script>
    <script src="https://databrickslabs.github.io/overwatch/js/hugo-learn.js?1619119001"></script>

    <link href="https://databrickslabs.github.io/overwatch/mermaid/mermaid.css?1619119001" rel="stylesheet" />
    <script src="https://databrickslabs.github.io/overwatch/mermaid/mermaid.js?1619119001"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

